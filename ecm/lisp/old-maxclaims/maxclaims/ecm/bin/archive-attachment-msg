#!/bin/sh
ECM_SCRIPT=$(readlink -f "$0")
ECM_SCRIPT_PATH=$(dirname "$ECM_SCRIPT")
. "$ECM_SCRIPT_PATH/../etc/ecm-conf"

# The claim is the first argument
ECM_CLAIM=${1-33342} ; shift
echo "Performing Attachment Archive for Claim #" $ECM_CLAIM;

# attachment is the second
ECM_ATTACHMENT=${1-33342} ; shift

# The attachment filename and directory
ECM_CLAIM_ATTACHMENT_PATH=$1 ;
ECM_CLAIM_ATTACHMENT_TYPE=`echo $ECM_CLAIM_ATTACHMENT_PATH \
                                | awk -F . '{print $NF}'`

echo "Path is " $ECM_CLAIM_ATTACHMENT_PATH;
echo "Type is " $ECM_CLAIM_ATTACHMENT_PATH;

case "$ECM_CLAIM_ATTACHMENT_TYPE" in
     msg) $ECM_SCRIPT_PATH/ecm-msg-convert "$ECM_CLAIM_ATTACHMENT_PATH" \
                | $ECM_SCRIPT_PATH/ecm-msg-archive $ECM_CLAIM -i ;;
  *) echo "trying to pipe input to hypermail" ; cat - | $ECM_SCRIPT_PATH/ecm-hypermail $ECM_CLAIM -i ;;
esac
